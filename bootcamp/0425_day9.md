## 0425_Day9
<JavaScript 문법 종합반> 강의 내용 정리 부분

## 1. `LexicalEnvironment`에서 스코프
- **스코프** : 식별자에 대한 유효범위

- **`outerEnvironmentReference(outer)`**
  - 스코프 체인이 가능하도록 하는 것
  - **외부 환경의 참조 정보**

- **스코프 체인**
  - 식별자의 유효범위를 안에서부터 바깥으로 차례로 검색해 나가는 것
  - `outer`는 **현재 호출된 함수가 선언될 당시**의 `LexicalEnvironment`를 참조한다(그 당시의 환경 정보를 저장한다).
  - 예: A 함수 내부에 B 함수 선언 -> B 함수 내부에 C 함수 선언(Linked List)한 경우
    - 결국 타고 올라가다 보면 전역 컨텍스트의 `LexicalEnvironment`를 참조하게 된다.
  - 항상 `outer`는 오직 자신이 **선언된 시점**의 `LexicalEnvironment`를 참조하고 있으므로, **가장 가까운 요소부터 차례대로 접근이 가능**하다.
  - 결론: 무조건 스코프 체인 상에서 **가장 먼저 발견된 식별자에게만 접근이 가능**하다.
  - 각각의 실행 컨텍스트는 `LE` 안에 **`record`와 `outer`를 가지고 있고**, `outer` 안에는 그 **실행 컨텍스트가 선언될 당시의 `LE` 정보**(`outer` 입장에서는 전역 컨텍스트)가 다 들어 있으니 스코프 체인에 의해 상위 컨텍스트의 `record`를 읽어올 수 있다.
    ```javascript
    var a = 1;

    var outer = function() {
      var inner = function() {
        console.log(a); // undefined (첫 번째로 출력)
        var a = 3;
      };

      inner();
      console.log(a); // 1 (두 번째로 출력)
    };

    outer();
    console.log(a); // 1 (세 번째로 출력)
    ```

## 2. 상황에 따라 달라지는 `this`
- 실행 컨텍스트는 **실행할 코드에 제공할 환경 정보**들을 모아놓은 객체이고, 그 객체 안에는 3가지 정보가 존재한다.
  - `VariableEnvironment`
  - `LexicalEnvironment`
  - **`ThisBindings`**

- `this`는 실행 컨텍스트가 생성될 때 결정된다.

- 이 말을 "`this`를 bind한다(묶는다)"라고도 한다.

- 다시 말하면, `this`는 함수를 호출할 때 결정된다.

- 전역 공간에서의 `this`
  - 전역 객체를 가리킨다.
  - 런타임 환경에 따라 `this`는 각각 `window`(브라우저 환경) 또는 `global`(노드 환경)를 가리킨다.
  - 런타임 환경
    - JavaScript로 만들어 놓은 프로그램이 구동 중인 환경
    - 우리는 `node 파일이름.js`로 VSCode 상에서 구동하고 있으니, "node 환경"이라고 할 수 있다.
    - html 파일 안에 숨겨놓아서 크롬 브라우저 등에서 여는 경우에는 "브라우저 환경"이라고 할 수 있다.

- 메서드로서 호출할 때 그 메서드 내부에서의 `this`
  - 함수 vs. 메서드
    - 차이점: **독립성**
    - 함수는 그 자체로 독립적인 기능을 수행한다.
      > 함수명();
    - 메서드는 자신을 호출한 대상 객체에 대한 동작을 수행한다.
      > 객체.메서드명();
  - `this`의 할당
    - 함수
      ```javascript
      // 호출 주체를 명시할 수 없기 때문에 this는 전역 객체를 의미함
      var func = function(x) {
        console.log(this, x);
      };

      func(1); // Window { ... } 1
      ```
    - 메서드
      ```javascript
      // 호출 주체를 명시할 수 있기 때문에 this는 해당 객체(obj)를 의미함
      // obj는 곧 { method: f }를 의미함
      var obj = {
        method: func,
      };

      obj.method(2); // { method: f } 2
      ```
  - 함수로서의 호출과 메서드로서의 호출 구분 기준: `.` 또는 `[]`
    ```javascript
    var obj = {
      method: function (x) {
        console.log(this, x);
      }
    };

    obj.method(1); // { method: f } 1
    obj['method'](2); // { method: f } 2
    ```
  - 메서드 내부에서의 `this` : **호출을 누가 했는지에 대한 정보**가 담긴다.
    ```javascript
    var obj = {
      methodA: function () {
        console.log(this);
      },
      inner: {
        methodB: function () {
          console.log(this);
        },
      },
    };

    obj.methodA(); // this === obj
    obj['methodA'](); // this === obj
    obj.inner.methodB(); // this === obj.inner
    obj.inner['methodB'](); // this === obj.inner
    obj['inner'].methodB(); // this === obj.inner
    obj['inner']['methodB'](); // this === obj.inner
    ```

- 함수로서 호출할 때 그 함수 내부에서의 `this`
  - 함수 내부에서의 `this`
    - 어떤 함수를 함수로서 호출할 경우, 호출 주체를 알 수 없기 때문에 `this`는 지정되지 않는다.
    - 실행 컨텍스트를 활성화할 당시 `this`가 지정되지 않은 경우, `this`는 전역 객체를 의미한다.
    - 따라서, 함수로서 **독립적으로 호출**할 때는 **`this`는 항상 전역 객체를 가리킨다.**
  - 메서드 내부 함수에서의 `this`
    - 메서드의 내부라고 해도, 함수로서 호출한다면 `this`는 전역 객체를 의미한다.
      ```javascript
      var obj1 = {
        outer: function() {
          console.log(this); // (1)
          var innerFunc = function() {
            console.log(this); // (2), (3)
          }

          innerFunc();

          var obj2 = {
            innerMethod: innerFunc
          };

          obj2.innerMethod();
        }
      };

      obj1.outer();

      // (1): obj1, (2): 전역 객체, (3): obj2
      ```
    - `this` 바인딩에 관해서는 함수를 실행하는 당시의 주변 환경(메서드 내부인지, 함수 내부인지)은 중요하지 않고, 오직 **해당 함수를 호출하는 구문 앞에 점 또는 대괄호 표기가 있는지**가 관건이다.

- 메서드의 함수 내부에서의 `this` 우회
  - 변수를 활용하는 방법
    - 내부 스코프에 이미 존재하는 `this`를 별도의 변수에 할당한다.
      ```javascript
      var obj1 = {
        outer: function() {
          console.log(this); // (1) outer

          // AS-IS
          var innerFunc1 = function() {
            console.log(this); // (2) 전역 객체
          }
          innerFunc1();

          // TO-BE
          var self = this;
          var innerFunc2 = function() {
            console.log(self); // (3) outer
          }
          innerFunc2();
        }
      };

      obj1.outer();
      ```
  - 화살표 함수를 사용하는 방법
    - ES6에서 처음 도입된 화살표 함수는 **`this`를 바인딩하지 않는다.**
    - ES6에서는 함수 내부에서 `this`가 전역 객체를 바라보는 문제 때문에 화살표 함수를 도입했다.
    - 화살표 함수는 실행 컨텍스트를 생성할 때 `this` 바인딩 과정 자체가 없다.
    - 따라서 `this`는 이전의 값(상위값)이 유지된다.
    - 일반 함수와 화살표 함수의 가장 큰 차이점: **`this` 바인딩 여부**
      ```javascript
      var obj = {
        outer: function() {
          console.log(this); // (1) obj

          var innerFunc = () => {
            console.log(this); // (2) obj
          }
          innerFunc();
        }
      }

      obj.outer();
      ```

- 콜백 함수 호출 시 그 함수 내부에서의 `this`
  - 콜백 함수: 어떠한 함수, 메서드의 인자(매개변수)로 넘겨주는 함수
  - 콜백 함수 내부의 `this`는 해당 콜백 함수를 넘겨받은 함수(메서드)가 정한 규칙에 따라 값이 결정된다.
  - **콜백 함수도 함수**이기 때문에 `this`는 전역 객체를 참조하지만, 콜백 함수를 넘겨받은 함수에서 **콜백 함수에 별도로 `this`를 지정한 경우**는 예외적으로 그 대상을 참조하게 되어 있다.
    ```javascript
    setTimeout(function() {
      console.log(this); // 별도 지정 없음: 전역 객체
    }, 300);
    ```
    ```javascript
    [1, 2, 3, 4, 5].forEach(function(x) {
      console.log(this, x); // 별도 지정 없음: 전역 객체
    });
    ```
    ```javascript
    // addEventListener() 메서드 안에서의 this는 항상 호출한 주체의 element를 return하도록 설계되었음
    // 따라서 this는 'button'을 의미함
    document.body.innerHTML += '<button id="a">클릭</button>';
    document.body.querySelector("#a").addEventListener("click", function(e) {
      console.log(this, e); // button 태그
    })
    ```

- 생성자 함수 내부에서의 `this`
  - **생성자** : 구체적인 인스턴스(객체)를 만들기 위한 일종의 틀
  - 공통 속성들이 이미 준비되어 있다.
    ```javascript
    var Cat = function(name, age) {
      this.bark = "야옹";
      this.name = name;
      this.age = age;
    };

    var choco = new Cat("초코", 3); // this: choco
    var nabi = new Cat("나비", 7); // this: nabi
    ```

## 3. 명시적 `this` 바인딩

## 4. 콜백(callback) 함수

<br>
<hr>
<br>
<프로그래머스 코딩테스트> 자바스크립트 문법 정리 부분

## 